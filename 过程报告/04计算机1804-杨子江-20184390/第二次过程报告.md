# 编译第一次过程报告

## 设计分工：

组长学号及姓名：20184317彭明均

分工：文法设计、数据结构设计、语法分析（LL1）、基于DAG的中间代码优化、部分目标代码生成

组员1学号及姓名：20184454谢一帆

分工：文法设计、符号表组织、部分目标代码生成

组员2学号及姓名：20184540梁俊涛

分工：文法设计、中间代码生成（LR0）、部分目标代码生成

组员3学号及姓名：20184390杨子江

分工：文法设计、词法分析、部分目标代码生成

### 3.4 目标代码生成

#### 3.4.1 功能

- 四元式预处理

- 符号表预处理

- 调用中间代码优化

- 获取完成优化的四元式

- 生成目标代码

  大多数编译程序不产生绝对地址的机器代码，而是以汇编语言程序作为输出使代码生成阶段变得更加容易。此外，指令集的选择以及指令的执行速度都是重要因素。

#### 3.4.2 数据结构

struct elem4 {/*四元式结构*/
	int idact;
	char id1[15];
	char id2[15];
	type type1;
	type type2;
	char id3[15];
};
elem4 action[100];



#### 3.4.3 算法

在目标代码生成这一个环节，我们首先要对符号表和四元式进行预处理，对四元式进行优化使其更加方便我们进行目标代码生成的操作。

目标代码生成环节的具体操作为:

1.打开优化后的四元式文件，依次读入四元式。

2.读取四元式，判断四元式的类型。

3.判断数据类型，如果与四元式类型不匹配则报错，反之进行翻译。

4.打开目标代码文件，写入生成的目标代码。

#### 3.4.5 程序截图

待翻译源代码如下：

<img src="C:\Users\MI\AppData\Roaming\Typora\typora-user-images\image-20200707185009808.png" alt="image-20200707185009808" align='left'  />

四元式预处理：

<img src="C:\Users\MI\AppData\Roaming\Typora\typora-user-images\image-20200707185121809.png" alt="image-20200707185121809" align='left'  />

预处理的符号表：

<img src="C:\Users\MI\AppData\Roaming\Typora\typora-user-images\image-20200707185244784.png" alt="image-20200707185244784" align='left'  />

生成的目标代码：

<img src="C:\Users\MI\AppData\Roaming\Typora\typora-user-images\image-20200707185319555.png" alt="image-20200707185319555" align='left'  />

<img src="C:\Users\MI\AppData\Roaming\Typora\typora-user-images\image-20200707185409646.png" alt="image-20200707185409646" align='left'  />

<img src="C:\Users\MI\AppData\Roaming\Typora\typora-user-images\image-20200707185502929.png" alt="image-20200707185502929" align='left'  />

<img src="C:\Users\MI\AppData\Roaming\Typora\typora-user-images\image-20200707185542211.png" alt="image-20200707185542211" align='left'  />

<img src="C:\Users\MI\AppData\Roaming\Typora\typora-user-images\image-20200707185704867.png" alt="image-20200707185704867" align='left'  />

## 4. 程序设计与实现

### 4.1 程序说明

​		本程序实现的简单编译器中，变量定义只能有int、float、char、string型，最后在目标代码生成过程中允许出现bool型，其他变量类型均不支持，然后便是支持函数返回类型为int、float、char、void型，暂不支持指针等类型，本编译器还支持if判断语句，while循环语句，+、-、*、/运算，以及支持>、<、>=、<=、==五个逻辑运算，也支持赋值运算，另外也实现了对cin、cout的输入输出。做到了类型检查和重定义的判断。

​		语法分析部分采用的是LL1分析方法，这是一种自上而下的语法分析法，又称为预测分析法，语法分析器部分实现了自动求first集合和follow集合，采用的是递归程序获得select集合，在实现对产生式完全扫描以后，便可以获得一张完整的分析表，表中标注了是否为预测以及对应的产生式序列，而后进行语法分析，通过于获得的分析表进行比对，进行入栈出栈，匹配到相同的则认为匹配成果，当文法匹配成功，同时单词也匹配成功的时候，认为语法分析完成，语法无错误，否则报错。

​		中间代码优化部分是对填装完毕的中间代码的再处理，也就是减少无用式子，给目标代码的生成提供便利，先进行基本块划分，而后采取的是DAG图优化，即无环有向图优化，顺序是构建DAG图（无环有向图），减少无用分支，或删改部分同义分支，完成DAG图改造后便又重新由树组装四元式，组装好的四元式又再次重新输出到文件中。

​		目标代码生成部分较长，也并不仅仅包含目标代码生成部分，在这个部分文件中，同时需要对前述获得的符号表，中间代码进行再处理，以得到符号目标代码生成所用的符号表和中间代码，再进行预处理完成之后，具体为根据四元式动作，按顺序依次生成目标代码，需要依据不同的四元式动作每个采取不同的操作方法，生成相应目标代码。

​		测试部分采用的Dosbox软件，最后进行的是对目标代码的正确性检验以及运行，运行通过且符合源程序实际操作即认为编译器任务完成。

### 4.2 实验结果

输入1后计算1至100的累加值为5050，十六进制为13BAH

<img src="C:\Users\MI\AppData\Roaming\Typora\typora-user-images\image-20200707193236508.png" alt="image-20200707193236508" align='left'  />

## 5. 收获、体会和建议

​		在这次编译原理课程设计中我负责的是一部分文法设计、词法分析、一部分目标代码生成。相对来说，我们在前端进度较快，就我个人而言，由于之前的实验课做过词法分析器，所以在文法设计讨论完成后，我花费了一定时间根据我们的需求重新设计编写了词法分析器，使得能够满足我们后续需求。但是在后端部分，由于理解较为困难，并且较为生疏的缘故，我们的进度十分缓慢，遇到了不少的问题。在目标代码生成部分，我分到的是相比起来较为容易实现的算术运算以及数据判断部分。这一部分通过查阅资料和向其他同学请教，最终解决了翻译问题。

​	编译原理课程设计是一门较为抽象的课程，涉及到的语法分析、中间代码生成、优化和目标代码生成等都比较难以理解。但是我们通过小组合作的形式，大家互相讨论，查阅资料，最终还是实现了一个较为简单编译器。通过这次课程设计，让我们不但对编译原理这门课程有了深入的理解，更是锻炼了我们团队合作能力，尤其是对Github的使用，让小组合作变得更为便捷，也让我们对这个平台有了一定的掌握。

  总的来说，通过这次课程设计，我们可以说是提前熟悉掌握了Github的操作，使得我们的团队合作能力有了进一步的提升。通过这次课程设计，由于我们选择的目标代码是汇编语言，所以我们顺带还复习了一下汇编语言和C语言的对应关系，对这两种语言之间的对应联系有了进一步的理解。但是同时，我们实现的编译器也较为简单，很多识别功能都不是很完善，这既有能力不足也有时间紧迫的缘故，希望我们能在以后的学习生活中提升自己，做到不断的进步。